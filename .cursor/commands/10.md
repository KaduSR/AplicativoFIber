Tarefa 10: Corrigir Redirecionamento de Logout (Root Layout)
Objetivo: Forçar o app/_layout.tsx (o navegador principal) a "ouvir" o estado user do AuthContext e redirecionar ativamente para o login quando o user for null.

Contexto: O logout (botão "Sair") está a chamar a função signOut (corrigida na Tarefa 09), que define user como null. No entanto, o Stack (navegador) não está a reagir a essa mudança.

Modificações no seu app/_layout.tsx
Instruções:

Abra o ficheiro: AplicativoFIber/app/_layout.tsx

Adicione as Importações: Precisamos do useRouter (para forçar o redirecionamento) e do useEffect (para reagir às mudanças).

TypeScript

// Em: app/_layout.tsx
// (No topo, junto com os outros imports)

import { AuthProvider, useAuth } from '@/contexts/AuthContext'; // (Verifique se o useAuth está a ser importado do AuthContext ou do hook)
import { Stack, useRouter } from 'expo-router';
import { useEffect } from 'react';
// ... (outros imports, como SplashScreen, Fonts, etc.)
Crie o Componente de Navegação (A Correção): A forma correta de fazer isto no Expo Router é criar um subcomponente (vamos chamá-lo RootLayoutNav) que viva dentro do AuthProvider.

Substitua o seu return (que provavelmente só tem o <Stack>) por este código completo:

TypeScript

// Em: app/_layout.tsx

// ... (imports)

// (Opcional: se o SplashScreen estiver aqui, mantenha-o)
// SplashScreen.preventAutoHideAsync();

export default function RootLayout() {
  // (O seu código de carregar fontes, se existir, fica aqui)

  return (
    <AuthProvider>
      <RootLayoutNav />
    </AuthProvider>
  );
}

/**
 * Este é o componente que gere a navegação
 * (Obrigatório estar separado para poder aceder ao 'useAuth')
 */
function RootLayoutNav() {
  const { user, isLoading } = useAuth(); // Pega o estado do utilizador
  const router = useRouter();

  // --- ESTE É O BLOCO DE LÓGICA DE REDIRECIONAMENTO ---
  useEffect(() => {
    // Se ainda estiver a carregar, não faças nada
    if (isLoading) return;

    if (!user) {
      // Se o utilizador for NULO (logout), força o redirecionamento
      // para a tela de login.
      router.replace('/login');
    } else {
      // Se o utilizador EXISTIR (login), força o redirecionamento
      // para a tela principal (tabs).
      router.replace('/(tabs)');
    }

  }, [user, isLoading]); // <- "Ouve" as mudanças nestas duas variáveis
  // --- FIM DO BLOCO DE LÓGICA ---


  // Este Stack gere as duas telas (Login e Tabs)
  // O 'useEffect' acima trata de alternar entre elas.
  return (
    <Stack screenOptions={{ headerShown: false }}>
      <Stack.Screen name="login" />
      <Stack.Screen name="(tabs)" />
    </Stack>
  );
}