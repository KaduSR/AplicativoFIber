Tarefa 12: Exibir Erros Reais do Backend (Debug do Login)
Objetivo: Modificar o contexts/AuthContext.tsx para que ele pare de usar o mockLogin como fallback e, em vez disso, mostre um alerta (Alert) com a mensagem de erro real que vem do backend (server.js).

Contexto: Estamos a receber "dados placeholder", o que indica que o authService.login está a falhar e o mockLogin está a ser chamado. Precisamos de ver o erro real (ex: "Usuário ou senha inválidos (C2)" ou "Nenhum contrato encontrado") para depurar o backend.

Modificações no seu contexts/AuthContext.tsx
Instruções:

Abra o ficheiro: AplicativoFIber/contexts/AuthContext.tsx

Adicione a Importação do Alert: No topo do ficheiro, adicione Alert à importação do react-native:

TypeScript

// Em: contexts/AuthContext.tsx

import React, { createContext, useState, useEffect, ReactNode } from 'react';
import { Alert } from 'react-native'; // <-- ADICIONE ESTA LINHA
import { authService } from '@/services/authService';
// ... (outros imports)
Encontre a função signIn: Procure pela função signIn (ou handleSignIn) dentro do AuthProvider.

Substitua a função signIn: Substitua a sua função signIn existente por este novo bloco de código. A mudança principal é o catch (error):

TypeScript

// Em: contexts/AuthContext.tsx
// (Dentro do 'AuthProvider')

const signIn = async (credentials: IXCLoginRequest) => {
  setIsLoading(true);
  try {
    // --- MODIFICAÇÃO INICIA AQUI ---

    // 1. Tenta o login REAL (Tarefa 08)
    console.log("Tentando login real...");
    const userData = await authService.login(credentials);

    // 2. Se funcionar, define o utilizador e sai
    setUser(userData);
    await AsyncStorage.setItem('@FiberApp:user', JSON.stringify(userData));

    // 3. (OPCIONAL) Removemos a chamada ao mockLogin
    // Se você quer parar de usar o mockLogin completamente, comente a linha abaixo
    // que chama o mockLogin (se ela existir no seu 'try').

  } catch (error) {
    // 4. ESTA É A CORREÇÃO MAIS IMPORTANTE
    // Se o login real falhar, mostramos o erro real que veio do backend

    console.error("Falha no login real:", error);

    // Mostra o erro exato do 'server.js' (ex: "Usuário ou senha inválidos (C2)")
    if (error instanceof Error) {
      Alert.alert("Erro no Login", error.message);
    } else {
      Alert.alert("Erro no Login", "Ocorreu um erro desconhecido.");
    }

    // 5. Garantimos que o utilizador fica nulo
    setUser(null);
    await AsyncStorage.removeItem('@FiberApp:user');

    // (Aqui é onde o seu código provavelmente estava a chamar o mockLogin como fallback)
    // (Vamos remover isso para podermos ver o erro real)

    // --- MODIFICAÇÃO TERMINA AQUI ---
  } finally {
    setIsLoading(false);
  }
};